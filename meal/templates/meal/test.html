<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>음식 검색 예제</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
    <!-- 동적으로 추가되는 input 창들 -->
    <div id="input-container">
        <input type="text" class="food-input" name="food_info[]" placeholder="음식 검색">
    </div>

    <!-- 검색 결과를 표시할 리스트들 -->
    <div id="search-results-container"></div>

    <script>
        $(document).ready(function(){
            // input 요소에 입력이 발생할 때마다 검색을 수행
            $(document).on('input', '.food-input', function(){
                var searchTerm = $(this).val();
                var resultsContainer = $(this).siblings('.search-results');

                // 서버로 AJAX 요청을 보냄
                $.ajax({
                    url: '/search-foods/',  // 실제 URL에 맞게 수정
                    data: {'searchTerm': searchTerm},
                    dataType: 'json',
                    success: function(data){
                        resultsContainer.empty();

                        // 검색 결과를 동적으로 표시
                        data.foods.forEach(function(food){
                            var listItem = $('<li>').text(food.name);

                            // 리스트 아이템을 클릭했을 때 처리
                            listItem.on('click', function(){
                                // 클릭한 음식의 food_code를 input의 value에 할당
                                $(this).closest('.input-container').find('.food-input').val(food.food_code);
                                resultsContainer.empty();  // 결과 리스트를 지움
                            });

                            resultsContainer.append(listItem);
                        });
                    }
                });
            });

            // 동적으로 input 창을 추가하는 버튼 클릭 이벤트
            $('#add-input-button').on('click', function(){
                var newInput = $('<input>', {
                    type: 'text',
                    class: 'food-input',
                    name: 'food_info[]',
                    placeholder: '음식 검색'
                });

                var newResultsContainer = $('<ul>', {
                    class: 'search-results'
                });

                // 동적으로 추가된 input과 결과 리스트를 감싸는 컨테이너 추가
                var newContainer = $('<div>', {
                    class: 'input-container'
                }).append(newInput, newResultsContainer);

                $('#input-container').append(newContainer);
            });
        });
    </script>

    <!-- 동적으로 input 창을 추가하는 버튼 -->
    <button id="add-input-button">새로운 음식 추가</button>
</body>
</html>
