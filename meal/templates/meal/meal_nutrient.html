<style>
    #progress {
        width: 60%;
        appearance: none;
    }

    #progress::-webkit-progress-bar{
        background: #f0f0f0;
        border-radius: 5px;
        box-shadow: inset 3px 3px 10px #b5b5b5;
    }

    #progress::-webkit-progress-value {
        border-radius: 5px;
        /* background: #fff879; */
        /* background: -webkit-linear-gradient(to right, #1739a9, #98c016); */
        background: linear-gradient(to right, #7fcf9d, #0e9c13);
    }

    #progress.overweight::-webkit-progress-value {
        transition: 6s linear;
        background: linear-gradient(to right, #f28585, #ca1c1c);
    }

    #nutrient_info_box {
        margin: 0 auto;
    }

    #nutrient_table {
        margin: 0 auto;
    }

    .chart-container {
        display: inline-flex;
        justify-content: space-evenly;
        margin: 0 auto;
        position: relative;
        width: 80vw;
        height: 55vh;
        /* background-color: rgb(155, 255, 155); */
    }
</style>
<div id="nutrient_info_box">
    <ul>
        <li>식단 전체 칼로리 : {{ this_meal_cal }}</li>
        <li>탄수화물 : {{ total_nutrient.0 }}</li>
        <li>단백질 : {{ total_nutrient.1 }}</li>
        <li>지방 : {{ total_nutrient.2 }}</li>
        <li>당류 : {{ total_nutrient.3 }}</li>
        <li>나트륨 : {{ total_nutrient.4 }}</li>
        <li>포화지방 : {{ total_nutrient.5 }}</li>
    </ul>
    <p>영양소 정보 : {{ total_nutrient }}</p>
    <p>오늘 섭취량 : {{ todays_total_cal }}</p>
    <progress id="progress" value="0" min="0" max="2200">삽입</progress>
    <details>
        <summary>상세보기</summary>
        <table id="nutrient_table">
            <tr>
                <th>음식명</th>
                <th>칼로리</th>
                <th>단백질</th>
                <th>지방</th>
            </tr>
            {% for food in each_foods %}
            <tr>
                <td>{{ food.food_name }}</td>
                <td>{{ food.calories }}</td>
                <td>{{ food.protein }}</td>
                <td>{{ food.fat }}</td>
            </tr>
            {% endfor %}
        </table>
    </details>
    <div class="chart-container">
        <div>
            <p>{{ meal_type }} 식사 영양 밸런스</p>
            <p>탄수화물을 너무 많이 드셨어요</p>
        </div>
        <canvas id="nutrient_chart"></canvas>
    </div>
</div>
<script>
    $(document).ready(function() {
        let maxCalories = $("#progress").attr("max");
        // console.log(maxCalories);
        let calories = {{ todays_total_cal }}
        $("#progress").animate({
            // 애니메이션이 도달해야 하는 거리
            value: calories
        }, {
            duration: 3000,
            step: function (currentValue) {
                $("#progress").attr("value", currentValue);
            },
            complete: function() {
                $("#progress").attr("value", calories);

                if (calories > maxCalories) {
                    $("#progress").addClass("overweight");
                }
            }
        });

        // 차트 그려주는 기능
        var ctx = $("#nutrient_chart");
        var nutrientChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['탄수화물', '단백질', '지방', '당류', '나트륨', '포화지방'],
                datasets: [{
                    label: "그램",
                    data: {{ total_nutrient }},
                    backgroundColor: [
                        'rgba(155, 255, 155, 0.2)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                    ],
                    pointBackgroundColor: [
                        'rgb(255, 99, 132)'
                    ],
                    pointHoverBackgroundColor: [
                        '#fff',
                    ],
                    pointHoverBorderColor: [
                        'rgb(255, 99, 132)',
                    ]
                }]
            },
            options: {
                scale: {
                    angleLines: {
                        display: false
                    },
                    ticks: {
                        suggestedMin: 50,
                        suggestedMax: 150
                    }
                }
            }
        });
    });
</script>