{% extends 'base.html' %}
{% load static %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js""></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var ctx = document.getElementById('calorieChart').getContext('2d');
        var calorieChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ dates| safe }}, // 날짜 데이터
        datasets: [{
            label: '소비 칼로리',
            data: {{ calories| safe }}, // 칼로리 데이터
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        borderColor: 'rgba(255, 99, 132, 1)',
        borderWidth: 1
                }]
            },
        options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
        });
    });
</script>

<link rel=" stylesheet" href="{% static 'css/exercise.css' %}">

<div class="container">
    <header>
        <h2>{{ user.username }}님의 운동기록</h2>
        <br>
        <form method="post" action="{% url 'exercise_index' %}">
            {% csrf_token %}
            <input type="date" name="search_date" value="{{ today }}">
            <input type="submit" value="검색">
        </form>
    </header>
    <br><br>

    {% if exercises %}
    <div class="exercises-container">
        <h3>유산소</h3><br>
        <section class="exercise-section aerobic">
            {% for exercise in exercises %}
            {% if exercise.exercise_type == "유산소" %}
            <div class="exercise-card">
                <h3>{{ exercise.exercise_name }}</h3>
                <p>{{ exercise.exercise_date }}</p>
                <p>{{ exercise.exercise_amount }}분</p>
                <p>{{ exercise.calories_burned }}kcal</p>
                <div class="exercise-actions">
                    <a href="{% url 'exercise_edit' exercise.postnum %}">수정</a>
                    <a href="{% url 'exercise_delete' exercise.postnum %}" onclick="return confirm('삭제하시겠습니까?');">삭제</a>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </section>
        <h3>웨이트</h3>
        <section class="exercise-section weight">
            {% for exercise in exercises %}
            {% if exercise.exercise_type == "웨이트" %}
            <div class="exercise-card">
                <h3>{{ exercise.exercise_name }}</h3>
                <p>{{ exercise.exercise_date }}</p>
                <p>{{ exercise.exercise_amount }}분</p>
                <p>{{ exercise.calories_burned }}kcal</p>
                <p>무게 {{ exercise.weight }}kg</p>
                <p>{{ exercise.reps }}회</p>
                <p>{{ exercise.sets }}set</p>
                <div class="exercise-actions">
                    <a href="{% url 'exercise_edit' exercise.postnum %}">수정</a>
                    <a href="{% url 'exercise_delete' exercise.postnum %}" onclick="return confirm('삭제하시겠습니까?');">삭제</a>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </section>
    </div>

    {% else %}
    <p>운동 기록이 없습니다.</p>
    {% endif %}

    <div class="chart-container" style="position: relative; height: auto; width: 70%;">
        <canvas id="calorieChart"></canvas>
    </div>
</div>
{% endblock content %}

<!-- 
남은 할일 
1. 모델 넣기
2. 로그인 안했을 시 오류 해결
-->

<!-- 
    USE_TZ = False라서 발생하는 문제 해결법
    views.py에서 timezone.localdate()을 사용중이라면 
    datetime.date.today()로 바꾸기
 -->